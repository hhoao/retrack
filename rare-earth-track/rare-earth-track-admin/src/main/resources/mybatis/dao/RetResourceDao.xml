<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rare_earth_track.mgb.dao.RetResourceDao">
    <resultMap id="retResource" type="com.rare_earth_track.mgb.backup.RetResource">
        <result property="id" column="resourceId"/>
        <result property="createTime" column="resourceCreateTime"/>
        <result property="description" column="resourceDescription"/>
        <result property="url" column="resourceUrl"/>
        <result property="name" column="resourceName"/>
    </resultMap>
    <select id="getAllResources" resultType="com.rare_earth_track.mgb.backup.RetResource">
        select * from ret_resource;
    </select>

    <select id="getResourcesByUserId" resultMap="retResource">
        SELECT a.method      resourceMethod,
               a.create_time resourceCreateTime,
               a.description resourceDescription,
               a.url         resourceDescription,
               a.id          resourceId,
               a.name        resourceName
        FROM ret_resource a,
             (
                 SELECT t.id, t.name, t.sex, t.password, t.birthday, t.address, a_r.resource_id
                 FROM ret_resource_role_relation a_r,
                      (
                          SELECT id, t.name, t.sex, t.password, t.birthday, t.address
                          FROM ret_user_role_relation u_r,
                               (SELECT id, name, sex, password, birthday, address FROM ret_user where id = 1) t
                          WHERE t.id = u_r.user_id) t
                 WHERE t.id = a_r.role_id
             ) t
        WHERE t.id = a.id;
    </select>
</mapper>